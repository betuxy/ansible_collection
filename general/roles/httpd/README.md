# Ansible Role: Apache 2.x


An Ansible Role that installs Apache 2.x on RHEL/CentOS/Alma

## Requirements

If you are using SSL/TLS, you will need to provide your own certificate and key files. You can generate a self-signed certificate with a command like `openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout example.key -out example.crt`.

## Role Variables
| Variable                                   | type                     | default                                                                                               | required | description                                                                            |
|--------------------------------------------|--------------------------|-------------------------------------------------------------------------------------------------------|----------|----------------------------------------------------------------------------------------|
| `apache_server_root`                       | String                   | /etc/httpd                                                                                            | no       | Base directory for the server installation                                             |
| `apache_server_name`                       | String                   | inventory_hostname_short                                                                              | no       | Hostname and port that the server uses to identify itself                              |
| `apache_directory_index`                   | String                   | "index.php index.html"                                                                                | no       | List of resources to look for when the client requests a directory                     |
| `apache_log_format`                        | String                   | '"%V %{X-Forwarded-For}i %h %l %u %t \"%r\" %s %b \"%{Referer}i\" \"%{User-Agent}i\"" ansible_custom' | no       | Format specification for error log entries                                             |
| `apache_enable_sendfile`                   | bool                     | on                                                                                                    | no       | Use the kernel sendfile support to deliver files to the client                         |
| `apache_extended_status`                   | bool                     |                                                                                                       | no       | Keep track of extended status information for each request                             |
| `apache_fcgi_max_requests`                 | Integer                  |                                                                                                       | no       | Set PHP FastCGI max processes                                                          |
| `apache_files_match`                       | Dict                     |                                                                                                       | no       | Set FilesMatch                                                                         |
| `apache_header`                            | String/ List of Strings  |                                                                                                       | no       | Customization of HTTP request and response headers                                     |
| `apache_hostname_lookups`                  | bool                     |                                                                                                       | no       | Enables DNS lookups on client IP addresses                                             |
| `apache_keep_alive`                        | String                   |                                                                                                       | no       | Enables HTTP persistent connections                                                    |
| `apache_listen_directive`                  | String/ List of Strings  |                                                                                                       | no       | Override listen directive generation from vHosts and set them manually instead         |
| `apache_listen_lo`                         | String                   |                                                                                                       | no       | Override localhost address listened to (e.g. '127.0.0.1:80' instead of 'localhost:80') |
| `apache_listen_ip`                         | String                   | '*:80'                                                                                                | no       | Standard (http) ip:port httpd listens for incoming connections                         |
| `apache_ssl_listen_ip`                     | String                   | '*:443'                                                                                               | no       | Standard (https) ip:port httpd listens for incoming connections                        |
| `apache_log_level`                         | String                   |                                                                                                       | no       | Controls the verbosity of the ErrorLog                                                 |
| `apache_options`                           | String/ List of Strings  |                                                                                                       | no       | Configures what features are available in a particular directory                       |
| `apache_timeout`                           | Integer                  |                                                                                                       | no       | Amount of time the server will wait for certain events before failing a request        |
| `apache_mod`                               | String/ List of Strings  |                                                                                                       | no       | Add optional server modules                                                            |
| `apache_max_mem_free`                      | String                   |                                                                                                       | no       | Maximum of free Kbytes that every allocator is allowed to hold without calling free()  |
| `apache_mpm`                               | String                   | event                                                                                                 | yes      | Define multiprocessing module type                                                     |
| `apache_mpm_graceful_shutdown_timeout`     | String                   |                                                                                                       | no       | Specifies how many seconds a server should run after receiving a graceful-stop signal  |
| `apache_mpm_max_connections_per_child`     | String                   |                                                                                                       | no       | Limit on the number of connections that an individual child server process will handle |
| `apache_mpm_max_request_workers`           | String                   |                                                                                                       | no       | Limit on the number of simultaneous requests that will be served                       |
| `apache_mpm_max_spare_servers`             | String                   |                                                                                                       | no       | Desired maximum number of idle child server processes                                  |
| `apache_mpm_max_spare_threads`             | String                   |                                                                                                       | no       | Maximum number of idle threads                                                         |
| `apache_mpm_min_spare_servers`             | String                   |                                                                                                       | no       | Desired minimum number of idle child server processes                                  |
| `apache_mpm_min_spare_threads`             | String                   |                                                                                                       | no       | Minimum number of idle threads to handle request spikes                                |
| `apache_mpm_server_limit`                  | String                   |                                                                                                       | no       | Upper limit on configurable number of processes                                        |
| `apache_mpm_start_servers`                 | String                   |                                                                                                       | no       | Number of child server processes created at startup                                    |
| `apache_mpm_thread_limit`                  | String                   |                                                                                                       | no       | Sets the upper limit on the configurable number of threads per child process           |
| `apache_mpm_threads_per_child`             | String                   |                                                                                                       | no       | Number of threads created by each child process                                        |
| `apache_recv_buffer_size`                  | String                   |                                                                                                       | no       | TCP receive buffer size                                                                |
| `apache_send_buffer_size`                  | String                   |                                                                                                       | no       | TCP buffer size                                                                        |
| `apache_srv_stat_ip`                       | List of Strings          |                                                                                                       | no       | List of possible IPs to access /server-stats                                           |
| `apache_proxy_timeout`                     | Integer                  |                                                                                                       | no       | Network timeout for proxied requests                                                   |
| `apache_remote_ip_header`                  | String                   |                                                                                                       | no       | Declare the header field which should be parsed for useragent IP addresses             |
| `apache_server_signature`                  | String                   |                                                                                                       | no       | Configures the footer on server-generated documents                                    |
| `apache_server_tokens`                     | String                   |                                                                                                       | no       | Configures the Server HTTP response header                                             |
| `apache_trace_enable`                      | String                   |                                                                                                       | no       | Determines the behavior on TRACE requests                                              |
| `apache_use_canonical_name`                | String                   |                                                                                                       | no       | Configures how the server determines its own name and port                             |
| `apache_use_autoindex_conf`                | Boolean                  | True                                                                                                  | no       | Use the Parts of autoindex.conf used by autoindex_module                               |                                                                                        |
| `apache_icons_alias`                       | Boolean                  | True                                                                                                  | no       | Use the /icons alias in autoindex.conf                                                 |
| `apache_use_autoindex_module`              | Boolean                  | True                                                                                                  | no       | Load the Autoindex_Module                                                              |                                                                                        |
| `apache_deflate_config`                    | Bool                     | True                                                                                                  | no       |                                                                                        |
| `apache_custom_deflate_config`             | Dict                     |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`deflate []`                         | List of Strings          |                                                                                                       | no       | List of files to deflate                                                               |
| `apache_directory []`                      | List of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`path`                               | String                   | vhost.document_root                                                                                   | yes      |                                                                                        |                                                                                        |
| &emsp;`alias`                              | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`allow_override`                     | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`handler`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`dav`                                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`force_type`                         | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`directory_index`                    | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`options`                            | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`require`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_options`                        | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| `apache_location []`                       | List of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`path`                               | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;`allow_methods`                      | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`fcgid_wrapper`                      | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`alias`                              | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`options`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`require`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`redirect`                           | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`add_handler`                        | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`set_handler`                        | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`handler`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy_pass`                         | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| #######################                    | ###########              | ###################                                                                                   | #######  | ###############                                                                        |
| `apache_vhosts []`                         | list                     |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;`servername`                         | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;`serveralias`                        | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`listen_ip`                          | String / List of Strings | *                                                                                                     | yes      |                                                                                        |                                                                                        |
| &emsp;`ssl_listen_ip`                      | String / List of Strings | *                                                                                                     | no       |                                                                                        |                                                                                        |
| &emsp;`serveradmin`                        | String                   | webmaster@localhost                                                                                   | no       |                                                                                        |                                                                                        |
| &emsp;`set_env`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`set_env_if  `                       | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`document_root`                      | String                   | /var/www/vhosts/\<servername\>/htdocs                                                                 | no       |                                                                                        |                                                                                        |
| &emsp;`alias`                              | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`browser_match`                      | String/ List of Strings  |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`fcgid_wrapper`                      | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`use_canonical_name`                 | bool                     | false                                                                                                 | no       |                                                                                        |                                                                                        |
| &emsp;`keep_alive`                         | bool                     | true                                                                                                  | no       |                                                                                        |                                                                                        |
| &emsp;`header`                             | String/ List of Strings  |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`request_header`                     | String/ List of Strings  |                                                                                                       | no       |                                                                                        |
| &emsp;`hostname_lookups`                   | bool                     | false                                                                                                 | no       |                                                                                        |                                                                                        |
| &emsp;`script_alias`                       | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`options`                            | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`phpfpmaddressport`                  | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy_pass`                         | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy_pass_reverse`                 | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy_timeout`                      | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_engine`                   | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_verify`                   | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_check_peer_cn`            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_check_peer_name`          | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_check_peer_expire`        | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_proxy_protocol`                 | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`use_canonical_name`                 | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy_preserve_host`                | Bool                     |                                                                                                       | no       |                                                                                        |
| &emsp;`redirect`                           | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`timeout`                            | String                   |                                                                                                       | no       |                                                                                        |                                                                                         |
| &emsp;`server_signature`                   | String                   |                                                                                                       | no       |                                                                                        |                                                                                          |
| &emsp;`remote_ip_header`                   | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`log_level`                          | String                   | warn                                                                                                  | no       |                                                                                        |                                                                                        |
| &emsp;`log_format`                         | String                   | `"%V %{X-Forwarded-For}i %h %l %u %t \"%r\" %s %b\"%{Referer}i\" \"%{User-Agent}i\"" ansible_custom`  | no       |                                                                                        |                                                                                        |
| &emsp;`custom_log_format`                  | String                   | ansible_custom                                                                                        | no       |                                                                                        |                                                                                        |
| &emsp;`custom_log_path`                    | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`error_log_path`                     | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`directory_index`                    | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`directory []`                       | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`path`                   | String                   | vhost.document_root                                                                                   | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`allow_override`         | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`handler`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`directory_index`        | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`order`                  | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`allow`                  | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`auth_type`              | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`auth_name`              | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`auth_basic_provider`    | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`auth_user_file`         | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`allow_methods`          | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`require`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`local_file`             | String                   |                                                                                                       | no       | Ort an dem die .htpasswd lokal abgelegt ist, wenn eine kopiert werden soll             |                                                                                        |
| &emsp;`limit_except []`                    | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`options`                | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`require`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`ssl_options`            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`files []`                           | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`pattern`                | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`handler`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`header`                 | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`setenvif`               | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`ssl_options`            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`files_match []`                     | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`pattern`                | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`handler`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`header`                 | String/ List of Strings  |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`fpm_port`               | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`set_env_if`             | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`ssl_options`            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`rewrite []`                         | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`cond`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`rule`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;`location []`                        | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`path`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`alias`                  | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`options`                | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`redirect`               | String / List of Strings |
| &emsp;&emsp;&emsp;`allow_methods`          | String / List of Strings |
| &emsp;&emsp;&emsp;`require`                | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`add_handler`            | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`handler`                | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`proxy_pass`             | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`module []`                          | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`name`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`header`                 | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`setenvif`               | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`fcgid_wrapper`          | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`if []`                              | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`pattern`                | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`redirect`               | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`if_module []`                       | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`name`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`header`                 | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`proxy []`                           | list of Dicts            |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`path`                   | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`proxy_set`              | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`ssl_only`                           | Boolean                  |                                                                                                       | no       | Decide whether a non ssl vHost with a rewrite should be included                       |
| &emsp;`ssl []`                             | Dict                     |                                                                                                       | no       | Ports in vhost change accordingly                                                      |
| &emsp;&emsp;&emsp;`src_path`               | String                   | files/certs                                                                                           | no       | Specify the directory in which to look for certs                                       |                                                                                        |
| &emsp;&emsp;&emsp;`crt_local`              | Boolean                  | false                                                                                                 | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`owner`                  | String                   | apache                                                                                                | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`group`                  | String                   | root                                                                                                  | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`cert_file`              | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`cert_key`               | String                   |                                                                                                       | yes      |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`cert_chain`             | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`options`                | String / List of Strings |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`honor_cipher_order`     | String                   | on                                                                                                    | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`compression`            | String                   | off                                                                                                   | no       |                                                                                        |                                                                                        |
| &emsp;&emsp;&emsp;`insecure_renegotiation` | String                   |                                                                                                       | no       |                                                                                        |                                                                                        |
| &emsp;`php_value`                          | String / List of Strings |                                                                                                       |          |                                                                                        |                                                                                        |
| &emsp;`php_admin_value`                    | String / List of Strings |                                                                                                       |          |                                                                                        |                                                                                        |
| &emsp;`php_flag`                           | String / List of Strings |                                                                                                       |          |                                                                                        |                                                                                        |
| &emsp;`php_admin_flag`                     | String / List of Strings |                                                                                                       |          |                                                                                        |                                                                                        |

## Adding optional httpd modules
Please refer to the apache documentation for an overview of the available modules and their functionalities: https://httpd.apache.org/docs/2.4/en/mod/ <br>
The naming convention is `<module-name>_module`

**NOTE**<br>
Adding modules in `apache_mod` will not resolve the system dependencies. <br>
If you e.g. add the ssl module (`ssl_module`), the package mod_ssl will still have to be installed on the OS.

## Configure multiprocessing module (mpm)
Some mpm directives correlate and some others can't be applied to all modules.<br>
There are three modules to choose from:
- prefork (default)
- worker
- event

Unlike `worker` and `event`, `prefork` does not thread, therefore relating directives are not to be applied.

## Using the Role to copy certs
If you want to use this role to copy files you need to set the crt_local var and make sure that the files in your src_path have the same name as in the matching var (e.g. cert_file).

## Example Configuration
```
apache_php-fpm: &apache_php-fpm
  - pattern: \.php$
    handler: "proxy:fcgi://127.0.0.1"
    fpm_port: 9072

apache_proxy_def: &apache_proxy_def
  - path: "fcgi://127.0.0.1:9072"
    proxy_set: timeout=300

apache_vhosts:
  - servername: test
    serveradmin: "webmaster@localhost"
    listen_ip: "{{ ansible_ens224['ipv4']['address'] }}:80"
    ssl_listen_ip: "{{ ansible_ens224['ipv4']['address'] }}:443"
    document_root: "/var/www/vhosts/test/htdocs/web"
    ssl:
      cert_file: /var/testfile
    directory:
      - path: "/var/www/vhosts/test/htdocs/web"
        allow_override: "All"
        options: "Indexes FollowSymLinks ExecCGI"
        require: "all granted"
    files_match:
      - <<: *apache_php-fpm
    proxy:
      - <<: *apache_proxy_def
    if_module: 
        - name: "proxy_module"
          nested:
            - name: proxy_http_module
              proxy_pass:
                - "/test/api/test ws://127.0.0.1:8080/study/open retry=0"
                - "/test/api/test ws://127.0.0.1:8081/study/open retry=0"
              proxy_pass_reverse: "/test/api/test ws://127.0.0.1:8080"

    timeout: 600
    group: "customer"
    custom_log_format: ansible_custom
```
