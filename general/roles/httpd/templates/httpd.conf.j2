#jinja2:lstrip_blocks: True
# Ansible managed

ServerRoot "{{ apache_server_root }}"
ServerName {{ apache_server_name | d(inventory_hostname_short) }}

Include conf.modules.d/*.conf

User apache
Group apache

ServerAdmin root@localhost

<Directory />
    AllowOverride none
    Require all denied
</Directory>

<Directory "/var/www">
    AllowOverride None
    Require all granted
</Directory>

{% include 'server/server_directory.j2' %}

<IfModule dir_module>
    DirectoryIndex {{ apache_directory_index }}
</IfModule>

<Files ".ht*">
    Require all denied
</Files>

ErrorLog "logs/error_log"
LogLevel {{ apache_log_level }}

<IfModule log_config_module>
    LogFormat {{ apache_log_format }}
    CustomLog "logs/access_log" ansible_custom
</IfModule>

<IfModule alias_module>
    ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
</IfModule>

<Directory "/var/www/cgi-bin">
    AllowOverride None
    Options None
    Require all granted
</Directory>

<IfModule mime_module>
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

AddDefaultCharset UTF-8

<IfModule mime_magic_module>
    MIMEMagicFile conf/magic
</IfModule>
EnableSendfile {{ apache_enable_sendfile }}

{% include 'server/server_location.j2' %}
{% include 'server/server_conf.j2' %}

{% include 'server/server_module_mpm.j2' %}

IncludeOptional conf.d/*.conf
{% if apache_files_match is defined %}

    {% for match in apache_files_match %}
<FilesMatch "{{ match.pattern }}">
        {% if match.handler is defined %}
    SetHandler "{{ match.handler }}:{{ match.fpm_port }}"
        {% endif %}
        {% if match.set_env_if is defined %}
    SetEnvIf {{ match.set_env_if }}
        {% endif %}
        {% if match.options is defined and match.options is iterable and match.options is not string %}
    Options{% for option in match.options %} {{ option }}{% endfor %}
        {% elif match.options is defined %}
    Options {{ match.options }}
        {% endif %}
        {% if match.header is defined and match.header is iterable and match.header is not string %}
            {% for header in match.header %}
    Header {{ header }}
            {% endfor %}
        {% elif match.header is defined %}
    Header {{ match.header }}
        {% endif %}
        {% if match.ssl_options is defined and match.ssl_options is iterable and match.ssl_options is not string %}
    SSLOptions{% for option in match.ssl_options %} {{ option }}{% endfor %}
        {% elif match.ssl_options is defined %}
    SSLOptions {{ match.ssl_options }}
        {% endif %}
</FilesMatch>

    {% endfor %}
{% endif %}
